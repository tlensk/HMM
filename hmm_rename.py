#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sun Apr  7 14:54:11 2024

@author: tatianalenskaia
"""

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/001_ST/"
fInName ="A_ST.hmm"
fInName1 ="ST_info.txt"



path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/002_LT/"
fInName ="A_LT.hmm"
fInName1 ="LT_info.txt"


path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/003_PO/"
fInName ="A_PO.hmm"
fInName1 ="PO_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/004_HIJ/"
fInName ="A_HIJ.hmm"
fInName1 ="HIJ_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/005_HP/"
fInName ="A_HP.hmm"
fInName1 ="HP_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/006_HS/"
fInName ="A_HS.hmm"
fInName1 ="HS_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/007_HD/"
fInName ="A_HD.hmm"
fInName1 ="HD_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/008_MH/"
fInName ="A_MH.hmm"
fInName1 ="MH_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/009_PC/"
fInName ="A_PC.hmm"
fInName1 ="PC_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/010_TT/"
fInName ="A_TT.hmm"
fInName1 ="TT_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/011_HT1/"
fInName ="A_HT1.hmm"
fInName1 ="HT1_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/012_HT2/"
fInName ="A_HT2.hmm"
fInName1 ="HT2_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/013_TC/"
fInName ="A_TC.hmm"
fInName1 ="TC_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/014_TR/"
fInName ="A_TR.hmm"
fInName1 ="TR_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/015_TA1/"
fInName ="A_TA1.hmm"
fInName1 ="TA1_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/016_TS/"
fInName ="A_TS.hmm"
fInName1 ="TS_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/017_TACN/"
fInName ="A_TACN.hmm"
fInName1 ="TACN_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/018_TACC/"
fInName ="A_TACC.hmm"
fInName1 ="TACC_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/019_DTN/"
fInName ="A_DTN.hmm"
fInName1 ="DTN_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/020_THN/"
fInName ="A_THN.hmm"
fInName1 ="THN_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/021_TNLP/"
fInName ="A_TNLP.hmm"
fInName1 ="TNLP_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/022_THI/"
fInName ="A_THI.hmm"
fInName1 ="THI_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/023_CF/"
fInName ="A_CF.hmm"
fInName1 ="CF_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/024_DTP/"
fInName ="A_DTP.hmm"
fInName1 ="DTP_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/025_THP/"
fInName ="A_THP.hmm"
fInName1 ="THP_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/026_BH1/"
fInName ="A_BH1.hmm"
fInName1 ="BH1_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/027_BH2/"
fInName = "A_BH2.hmm"
fInName1 = "BH2_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/028_BH3/"
fInName ="A_BH3.hmm"
fInName1 ="BH3_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/029_TM/"
fInName ="A_TM.hmm"
fInName1 ="TM_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/029_TM/"
fInName = "A_TM.hmm"
fInName1 = "TM_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/030_BS/"
fInName ="A_BS.hmm"
fInName1 ="BS_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/031_BW1/"
fInName ="A_BW1.hmm"
fInName1 ="BW1_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/032_BW2/"
fInName ="A_BW2.hmm"
fInName1 ="BW2_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/033_BW3/"
fInName ="A_BW3.hmm"
fInName1 ="BW3_info.txt"


#--------------

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/010_TT/"
fInName ="A_TT.hmm"
fInName1 ="TT_info.txt"

path = "/Users/tatianalenskaia/HMM/All_HMMs/HMM_db/2024.04_updated/014_TR/"
fInName ="A_TR.hmm"
fInName1 ="TR_info.txt"



fIn = open(path+fInName,"r")
lines = fIn.readlines()
fIn.close()



fOutName = fInName.split(".")[0]+"_new.hmm"
fOut = open(path+fOutName,"w")
fOut.close()



n = len(lines)

t_i_st = []
t_i_nm = []
t_i_fn = []



for i in range(n):
    line = lines[i]    
    if line[0:5] == "HMMER":
        t_i_st.append(i)
    elif line[0:4] == "NAME":
        t_i_nm.append(i)
    
    elif line[0:2] == "//":
            t_i_fn.append(i)
            
if (len(t_i_st) != len(t_i_fn)) or (len(t_i_st) != len(t_i_nm)) or (len(t_i_nm) != len(t_i_fn)):
    print("check format: number of starts is not equal to the number of finishes!")
    
else:
    print(t_i_st)
    print(t_i_fn)
    k = len(t_i_st)
    
    t_names = []
    
    d_hmm = {}
        
    for j in range(k):
        t_hmm = lines[t_i_st[j]:t_i_fn[j]+1]
        nm = lines[t_i_nm[j]].strip().split()[-1]
        
        print(nm)
        
        t_names.append(nm)
        
        if nm not in d_hmm:
            d_hmm[nm] = t_hmm

    print(len(d_hmm))
    
    
    print("keys", list(d_hmm.keys()))
    
    d_alias = {}
    
    
    '''    
    for hmm in d_hmm:
        t_hmm = d_hmm[hmm]
        
        acc = ""
        desc = ""
        
        
        for it in t_hmm:
            if it[0:3] == "ACC":
                acc = it.strip().split()[-1]
            else:
                if it[0:4] == "DESC":
                    desc = it.strip()[6:]
        
        print(hmm, acc, desc, sep = "|")
        
        
        if acc != "":
            d_alias[acc] = hmm
            
        if "." in acc:    
            al = acc.split(".")[0]
            if al not in d_alias:
               d_alias[al] = hmm


            
        if "." in hmm:
            al = hmm.split(".")[0]
            if al not in d_alias:
               d_alias[al] = hmm'''


    d_ind = {}


    for hmm in d_hmm:
        t_hmm = d_hmm[hmm]

        acc = ""
        desc = ""

        i_nm = ""
        i_acc = ""
        i_desc = ""
        
        nn = len(t_hmm)
        
        
        
        for x in range(nn):
            it = t_hmm[x]
            
            if it[0:4] == "NAME":
                i_nm = x
            
            elif it[0:3] == "ACC":
                i_acc = x
                acc = it.strip().split()[-1]
            elif it[0:4] == "DESC":
                i_desc = x
                desc = it.strip()[6:]
        
        if hmm not in d_ind:
            d_ind[hmm] = [i_nm, i_acc, i_desc]
        
        
        #print(hmm, acc, desc, sep = "|")
        
        
        if acc != "":
            d_alias[acc] = hmm
            
        if "." in acc:    
            al = acc.split(".")[0]
            if al not in d_alias:
               d_alias[al] = hmm


            
        if "." in hmm:
            al = hmm.split(".")[0]
            if al not in d_alias:
               d_alias[al] = hmm
        





        

    print(d_alias)













fIn = open(path+fInName1,"r")
lns = fIn.readlines()
fIn.close()


lns = lns[1:]

for line in lns:
    line = line.strip()
    t_line = line.split("\t")
    
    fl = 0
    hmm_nm = ""
    
    print(t_line[0], "-------------")
    
    if t_line[0] not in d_hmm:
        t_alias = t_line[-1].split(";")
        
        #print(t_alias)
        
        
        
        for it in t_alias:
            #print(it)
            
            if (it in d_hmm) or (it in d_alias):
                print(t_line[0], it, "found")
                
                if it in d_hmm:
                    hmm_nm = it
                    #t_hmm = d_hmm[it]
                else:
                    hmm_nm = d_alias[it]
                    #t_hmm = d_hmm[d_alias[it]]

                fl = 1
                break
            else:
                if "." in it:
                    al = it.split(".")[0]
                    
                    if (al in d_hmm) or (al in d_alias):
                        print(t_line[0], it, al, "found")
                        
                        
                        if al in d_hmm:
                            hmm_nm = al
                            #t_hmm = d_hmm[al]
                        else:
                            hmm_nm = d_alias[al]
                            #t_hmm = d_hmm[d_alias[al]]
                        
                        
                        fl = 1
                        break
    else:
        print(t_line[0],"found")
        
        hmm_nm = t_line[0]
        #t_hmm = d_hmm[t_line[0]] 
        fl = 1
    


    if (fl == 1) and (hmm_nm != ""):
        
        t_hmm = d_hmm[hmm_nm]
        t_ind = d_ind[hmm_nm]
        
                
        for xx in t_ind:
            if xx != "":
                print(t_hmm[xx])

        
        
        
        if t_ind[0] != "":
            t_hmm[t_ind[0]] = "NAME  "+t_line[0]+"\n"
            
        if t_ind[1] != "":
            t_hmm[t_ind[1]] = "ACC   "+t_line[1]+"\n"
        else:
            t_hmm = t_hmm[0:t_ind[0]+1]+["ACC   "+t_line[1]+"\n"] + t_hmm[t_ind[0]+1:]
            t_ind[1] = t_ind[0]+1
            
        if t_ind[2] != "":
            t_hmm[t_ind[2]] = "DESC  "+t_line[2]+"\n"
        else:
            if t_ind[1]!= "":
                t_hmm = t_hmm[0:t_ind[1]+1]+["DESC  "+t_line[2]+"\n"] + t_hmm[t_ind[1]+1:]
            else:
                print("check inserts!!!")
                
        fOut = open(path+fOutName,"a")
        for st in t_hmm:
            fOut.write(st) 
        fOut.close()


        
        '''
        n_hmm = len(t_hmm)
        
        for l in range(n_hmm):
            item = t_hmm[l]
        '''
                
            
                            
    
        

